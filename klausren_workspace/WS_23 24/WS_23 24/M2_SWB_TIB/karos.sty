%*******************************************************************************
%
% LaTeX2e
%
\NeedsTeXFormat{LaTeX2e}
%*******************************************************************************

%*******************************************************************************
%
% Provide package 
%
\ProvidesPackage{karos}[2018/11/09 LaTeX package for grid paper ]
%*******************************************************************************

%*******************************************************************************
%
% package tikz: Die Karos werden als tikzpicture erstellt!
%
% \begin{tikzpicture}
%	...
% \end{tikzpicture}
%
\RequirePackage{tikz}
%*******************************************************************************

%*******************************************************************************
%
% package xcolor: Farbe der Karos!
%
\RequirePackage{xcolor}
\newcommand{\KarosColor}{lightgray}
\DeclareOption{black}{\renewcommand{\KarosColor}{black}}
\DeclareOption{darkgray}{\renewcommand{\KarosColor}{darkgray}}
\DeclareOption{gray}{\renewcommand{\KarosColor}{gray}}
\DeclareOption{lightgray}{\renewcommand{\KarosColor}{lightgray}}
\DeclareOption{red}{\renewcommand{\KarosColor}{red}}
\ProcessOptions\relax
%*******************************************************************************

%*******************************************************************************
%
% \ifblank: überprüfen, ob das Argument leer ist
% 
% Der Befehl wurde aus etoolbox.sty kopiert!
%
\providecommand{\ifblank}[1]{% from expl3
  \expandafter\ifx\expandafter\relax\detokenize\expandafter{\@gobble#1?}\relax
    \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi}
%*******************************************************************************

%*******************************************************************************
%
% package fp: Fixed point arithmetic for TeX
%
% Die Höhe und Breite der Karos werden mit \FPset, \FPmul, \FPdiv und \FPtrunc
% berechnet,
\RequirePackage{fp}
%*******************************************************************************

%*******************************************************************************
%
% \removedimension: Macro zum Entfernen von "`pt"'
%
{\catcode`p=12 \catcode`t=12 \gdef\removedimension#1pt{#1}}%
%*******************************************************************************

%*******************************************************************************
%
% Höhe und Breite der Karos berechnen!
%
\newlength\KarosWidth
\newlength\KarosHeight
\newlength\KarosLineWidth
\setlength{\KarosLineWidth}{0.25pt}
\newcommand{\karos}[2]{%
%
% Debug output
%
%textheight=\the\textheight,pagetotal=\the\pagetotal\\
%
% 1. Argument optional
%
\ifblank{#1}{%
\setlength{\KarosWidth}{\linewidth}%
}{% else
\setlength{\KarosWidth}{#1}%
}%
%
% 2. Argument optional
%
\ifblank{#2}{%
\setlength{\KarosHeight}{\textheight}%
\advance\KarosHeight by - \pagetotal%
}{% else
\setlength{\KarosHeight}{#2}%
}%
%
% Debug output
%
%KarosWidth=\the\KarosWidth,KarosHeight=\the\KarosHeight\\
%
% Dimensionsangabe "`pt"' entfernen
%
\FPset\Breite{\expandafter\removedimension\the\KarosWidth}%
\FPset\Hoehe{\expandafter\removedimension\the\KarosHeight}%
%
% Längenangabe von pt in halbe Zentimeter umrechnen
%
\FPmul\BreiteInHalbenZentimetern\Breite{0.0703}%
\FPmul\HoeheInHalbenZentimetern\Hoehe{0.0703}%
%
% Nachkommastellen abschneiden
%
\FPtrunc\BreiteInHalbenZentimeternGerundet\BreiteInHalbenZentimetern{0}%
\FPtrunc\HoeheInHalbenZentimeternGerundet\HoeheInHalbenZentimetern{0}%
%
% Umrechnung von halben Zentimetern in ganz Zentimeter
%  
\FPdiv\BreiteInZentimetern\BreiteInHalbenZentimeternGerundet2%
\FPdiv\HoeheInZentimetern\HoeheInHalbenZentimeternGerundet2%
%
% Gitter
%
\begin{minipage}{\KarosWidth}%
\begin{tikzpicture}[x=1cm,y=1cm]%
\draw[line width=\KarosLineWidth,step=0.5cm,color=\KarosColor] (0,0) grid (\BreiteInZentimetern,\HoeheInZentimetern);%
%
% Debug output
%
%\node[draw] at (0,0) {(\FPprint\BreiteInZentimetern{1},\FPprint\HoeheInZentimetern{1})};%
\end{tikzpicture}%
\end{minipage}%
}%
%*******************************************************************************
